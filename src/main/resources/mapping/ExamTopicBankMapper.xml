<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.upc.dao.ExamTopicBankMapper">
  <resultMap id="BaseResultMap" type="com.example.upc.dataobject.ExamTopicBank">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="option_a" jdbcType="VARCHAR" property="optionA" />
    <result column="option_b" jdbcType="VARCHAR" property="optionB" />
    <result column="option_c" jdbcType="VARCHAR" property="optionC" />
    <result column="option_d" jdbcType="VARCHAR" property="optionD" />
    <result column="option_e" jdbcType="VARCHAR" property="optionE" />
    <result column="option_f" jdbcType="VARCHAR" property="optionF" />
    <result column="answer" jdbcType="VARCHAR" property="answer" />
    <result column="analysis" jdbcType="VARCHAR" property="analysis" />
    <result column="score" jdbcType="REAL" property="score" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="operate_time" jdbcType="TIMESTAMP" property="operateTime" />
    <result column="operator" jdbcType="VARCHAR" property="operator" />
    <result column="operate_ip" jdbcType="VARCHAR" property="operateIp" />
  </resultMap>

  <resultMap extends="BaseResultMap" id="ResultMapCaParam" type="com.example.upc.controller.param.ExamCaTopic">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    <result column="check_answer" jdbcType="VARCHAR" property="check" />
    <result column="submit_time" jdbcType="TIMESTAMP" property="submitTime" />
  </resultMap>

  <resultMap id="BaseResultMap1" type="com.example.upc.controller.param.ExamTopicBankParam">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="option_a" jdbcType="VARCHAR" property="optionA" />
    <result column="option_b" jdbcType="VARCHAR" property="optionB" />
    <result column="option_c" jdbcType="VARCHAR" property="optionC" />
    <result column="option_d" jdbcType="VARCHAR" property="optionD" />
    <result column="option_e" jdbcType="VARCHAR" property="optionE" />
    <result column="option_f" jdbcType="VARCHAR" property="optionF" />
    <result column="answer" jdbcType="VARCHAR" property="answer" />
    <result column="analysis" jdbcType="VARCHAR" property="analysis" />
    <result column="score" jdbcType="REAL" property="industry" />
    <result column="status" jdbcType="INTEGER" property="workType" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="operate_time" jdbcType="TIMESTAMP" property="operateTime" />
    <result column="operator" jdbcType="VARCHAR" property="operator" />
    <result column="operate_ip" jdbcType="VARCHAR" property="operateIp" />
  </resultMap>

  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    id, title, type, option_a, option_b, option_c, option_d, option_e, option_f, answer,
    analysis, score, status, remark, operate_time, operator, operate_ip
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    select
    <include refid="Base_Column_List" />
    from exam_topic_bank
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    delete from exam_topic_bank
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.example.upc.dataobject.ExamTopicBank">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    insert into exam_topic_bank (id, title, type,
    option_a, option_b, option_c,
    option_d, option_e, option_f,
    answer, analysis, score,
    status, remark, operate_time,
    operator, operate_ip)
    values (#{id,jdbcType=INTEGER}, #{title,jdbcType=VARCHAR}, #{type,jdbcType=INTEGER},
    #{optionA,jdbcType=VARCHAR}, #{optionB,jdbcType=VARCHAR}, #{optionC,jdbcType=VARCHAR},
    #{optionD,jdbcType=VARCHAR}, #{optionE,jdbcType=VARCHAR}, #{optionF,jdbcType=VARCHAR},
    #{answer,jdbcType=VARCHAR}, #{analysis,jdbcType=VARCHAR}, #{score,jdbcType=REAL},
    #{status,jdbcType=INTEGER}, #{remark,jdbcType=VARCHAR}, #{operateTime,jdbcType=TIMESTAMP},
    #{operator,jdbcType=VARCHAR}, #{operateIp,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.example.upc.dataobject.ExamTopicBank">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    insert into exam_topic_bank
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="title != null">
        title,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="optionA != null">
        option_a,
      </if>
      <if test="optionB != null">
        option_b,
      </if>
      <if test="optionC != null">
        option_c,
      </if>
      <if test="optionD != null">
        option_d,
      </if>
      <if test="optionE != null">
        option_e,
      </if>
      <if test="optionF != null">
        option_f,
      </if>
      <if test="answer != null">
        answer,
      </if>
      <if test="analysis != null">
        analysis,
      </if>
      <if test="score != null">
        score,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="operateTime != null">
        operate_time,
      </if>
      <if test="operator != null">
        operator,
      </if>
      <if test="operateIp != null">
        operate_ip,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="title != null">
        #{title,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=INTEGER},
      </if>
      <if test="optionA != null">
        #{optionA,jdbcType=VARCHAR},
      </if>
      <if test="optionB != null">
        #{optionB,jdbcType=VARCHAR},
      </if>
      <if test="optionC != null">
        #{optionC,jdbcType=VARCHAR},
      </if>
      <if test="optionD != null">
        #{optionD,jdbcType=VARCHAR},
      </if>
      <if test="optionE != null">
        #{optionE,jdbcType=VARCHAR},
      </if>
      <if test="optionF != null">
        #{optionF,jdbcType=VARCHAR},
      </if>
      <if test="answer != null">
        #{answer,jdbcType=VARCHAR},
      </if>
      <if test="analysis != null">
        #{analysis,jdbcType=VARCHAR},
      </if>
      <if test="score != null">
        #{score,jdbcType=REAL},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="operateTime != null">
        #{operateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operator != null">
        #{operator,jdbcType=VARCHAR},
      </if>
      <if test="operateIp != null">
        #{operateIp,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.example.upc.dataobject.ExamTopicBank">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    update exam_topic_bank
    <set>
      <if test="title != null">
        title = #{title,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=INTEGER},
      </if>
      <if test="optionA != null">
        option_a = #{optionA,jdbcType=VARCHAR},
      </if>
      <if test="optionB != null">
        option_b = #{optionB,jdbcType=VARCHAR},
      </if>
      <if test="optionC != null">
        option_c = #{optionC,jdbcType=VARCHAR},
      </if>
      <if test="optionD != null">
        option_d = #{optionD,jdbcType=VARCHAR},
      </if>
      <if test="optionE != null">
        option_e = #{optionE,jdbcType=VARCHAR},
      </if>
      <if test="optionF != null">
        option_f = #{optionF,jdbcType=VARCHAR},
      </if>
      <if test="answer != null">
        answer = #{answer,jdbcType=VARCHAR},
      </if>
      <if test="analysis != null">
        analysis = #{analysis,jdbcType=VARCHAR},
      </if>
      <if test="score != null">
        score = #{score,jdbcType=REAL},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="operateTime != null">
        operate_time = #{operateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operator != null">
        operator = #{operator,jdbcType=VARCHAR},
      </if>
      <if test="operateIp != null">
        operate_ip = #{operateIp,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.example.upc.dataobject.ExamTopicBank">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 29 10:58:28 CST 2019.
    -->
    update exam_topic_bank
    set title = #{title,jdbcType=VARCHAR},
    type = #{type,jdbcType=INTEGER},
    option_a = #{optionA,jdbcType=VARCHAR},
    option_b = #{optionB,jdbcType=VARCHAR},
    option_c = #{optionC,jdbcType=VARCHAR},
    option_d = #{optionD,jdbcType=VARCHAR},
    option_e = #{optionE,jdbcType=VARCHAR},
    option_f = #{optionF,jdbcType=VARCHAR},
    answer = #{answer,jdbcType=VARCHAR},
    analysis = #{analysis,jdbcType=VARCHAR},
    score = #{score,jdbcType=REAL},
    status = #{status,jdbcType=INTEGER},
    remark = #{remark,jdbcType=VARCHAR},
    operate_time = #{operateTime,jdbcType=TIMESTAMP},
    operator = #{operator,jdbcType=VARCHAR},
    operate_ip = #{operateIp,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="countList" resultType="int">
    SELECT count(1)
    FROM exam_topic_bank
  </select>

  <select id="getPage" resultMap="BaseResultMap1">
    SELECT <include refid="Base_Column_List" />
    FROM exam_topic_bank
    WHERE 1 = 1
    <if test="search.title != null and search.title != ''">AND title LIKE CONCAT('%',#{search.title},'%')</if>
    <if test="search.type != null and search.type != ''">AND type = #{search.type}</if>
    <if test="search.industryCategory != null and search.industryCategory != ''">AND score = #{search.industryCategory}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>
    limit #{page.offset}, #{page.pageSize}
  </select>

  <select id="getList" resultMap="BaseResultMap">
    SELECT <include refid="Base_Column_List" />
    FROM exam_topic_bank
  </select>

  <select id="countByTitle" resultType="int">
    SELECT count(1)
    FROM exam_topic_bank
    WHERE title = #{title}
  </select>

  <select id="getByIdList" parameterType="map" resultMap="BaseResultMap">
    SELECT <include refid="Base_Column_List" />
    FROM exam_topic_bank
    WHERE id IN
    <foreach collection="idList" item="id" open="(" close=")" separator=",">
      #{id}
    </foreach>
  </select>

  <select id="getCaExamList" parameterType="map" resultMap="ResultMapCaParam">
    <!--    SELECT a.*,b.answer as check_answer,b.submit_time as submit_time FROM exam_topic_bank as a-->
    <!--    LEFT JOIN exam_submit as b on a.id = b.topic_id and b.ca_id = #{caId} and b.exam_id = #{examId}-->
    <!--    WHERE a.id IN-->
    <!--    <foreach collection="idList" item="id" open="(" close=")" separator=",">-->
    <!--      #{id}-->
    <!--    </foreach>-->
    select a.*,b.score
    From
    ( SELECT
    a.id,a.title,a.type,a.option_a,a.option_b,a.option_c,a.option_d,a.option_e,a.option_f,a.answer,a.analysis,a.status,a.remark,a.operate_time,a.operator,a.operate_ip
    <if test="paramList.examCaId != null and paramList.caId != null">,b.answer as check_answer,b.submit_time as submit_time</if>
    FROM exam_topic_bank as a
    <if test="paramList.examCaId != null and paramList.caId != null">LEFT JOIN exam_submit as b on a.id = b.topic_id and b.ca_id = #{paramList.caId} and b.exam_id = #{paramList.examCaId}</if>
    )as a
    LEFT JOIN exam_subject_topic as b on a.id=b.topic_id and b.subject_id = #{paramList.subjectId}
    WHERE a.id IN
    <foreach collection="idList" item="id" open="(" close=")" separator=",">
      #{id}
    </foreach>
  </select>

  <select id="getNum" resultType="com.example.upc.controller.param.TopicNumParam">
    SELECT A.*,B.*,C.*,D.*
    FROM
    (SELECT COUNT(*) as AllSingleOptionNum from exam_topic_bank WHERE type=2
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>)as A
    LEFT JOIN
    (SELECT COUNT(*) as AllMultipleOptionNum from exam_topic_bank WHERE type=3
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>) as B
    ON 1=1
    LEFT JOIN
    (SELECT COUNT(*) as AllJudgeNum from exam_topic_bank WHERE type=1
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>) as C
    ON 1=1
    LEFT JOIN
    (SELECT COUNT(*) as AllTopicNum from exam_topic_bank WHERE
    <if test="search.industry != null and search.industry != ''">score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>) as D
    ON 1=1
  </select>

  <select id="selectRandomByNum" parameterType="com.example.upc.controller.searchParam.ExamSubjectSearchParam" resultMap="BaseResultMap">
    (SELECT *
    FROM exam_topic_bank
    WHERE type=2
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>
    AND id >= (SELECT floor(RAND() * (SELECT MAX(id) FROM exam_topic_bank WHERE type=2
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>)))
    ORDER BY id LIMIT 0,#{search.singleNumber})
    UNION ALL
    (SELECT *
    FROM exam_topic_bank
    WHERE type=1
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>
    AND id >= (SELECT floor(RAND() * (SELECT MAX(id) FROM exam_topic_bank WHERE type=1
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>)))
    ORDER BY id LIMIT 0,#{search.judgementNumber})
    UNION ALL
    (SELECT *
    FROM exam_topic_bank
    WHERE type=3
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>
    AND id >= (SELECT floor(RAND() * (SELECT MAX(id) FROM exam_topic_bank WHERE type=3
    <if test="search.industry != null and search.industry != ''">AND score = #{search.industry}</if>
    <if test="search.workType != null and search.workType != ''">AND status = #{search.workType}</if>)))
    ORDER BY id LIMIT 0,#{search.multipleNumber})
  </select>
</mapper>