<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.upc.dao.GridPointsMapper">
    <resultMap id="BaseResultMap" type="com.example.upc.dataobject.GridPoints">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 13 11:08:39 CST 2019.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="area_id" jdbcType="INTEGER" property="areaId"/>
        <result column="enterprise_id" jdbcType="INTEGER" property="enterpriseId"/>
        <result column="point" jdbcType="VARCHAR" property="point"/>
        <result column="operate_time" jdbcType="TIMESTAMP" property="operateTime"/>
        <result column="operator" jdbcType="VARCHAR" property="operator"/>
        <result column="operate_ip" jdbcType="VARCHAR" property="operateIp"/>
    </resultMap>

    <resultMap id="BaseResultMap1" type="com.example.upc.controller.param.GridPoints1">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="area" jdbcType="INTEGER" property="area"/>
        <result column="grid" jdbcType="INTEGER" property="grid"/>
        <result column="permission_type" jdbcType="VARCHAR" property="permission_type"/>
        <result column="registered_address" jdbcType="VARCHAR" property="registered_address"/>
    </resultMap>

    <resultMap id="SmileMap" type="com.example.upc.controller.param.SmilePoints">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="enterprise_id" jdbcType="INTEGER" property="enterpriseId"/>
        <result column="enterprise_name" jdbcType="INTEGER" property="enterpriseName"/>
        <result column="shop_name" jdbcType="VARCHAR" property="shopName"/>
        <result column="id_number" jdbcType="VARCHAR" property="idNumber"/>
        <result column="cantact_way" jdbcType="VARCHAR" property="cantactWay"/>
        <result column="legal_person" jdbcType="VARCHAR" property="legalPerson"/>
        <result column="point" jdbcType="VARCHAR" property="point"/>
        <result column="area" jdbcType="INTEGER" property="area"/>
        <result column="grid" jdbcType="INTEGER" property="grid"/>
        <result column="registered_address" jdbcType="VARCHAR" property="registered_address"/>
        <result column="propaganda_enclosure" jdbcType="VARCHAR" property="propagandaEnclosure"/>
        <result column="dynamic_grade" jdbcType="VARCHAR" property="dynamic_grade"/>
        <result column="operation_mode" jdbcType="VARCHAR" property="operationMode"/>
        <result column="business_state" jdbcType="INTEGER" property="businessState"/>
        <result column="max_time" jdbcType="TIMESTAMP" property="endTime"/>
        <result column="a1_id" jdbcType="INTEGER" property="foodBusiness"/>
        <result column="a2_id" jdbcType="INTEGER" property="foodCommon"/>
        <result column="a3_id" jdbcType="INTEGER" property="foodCirculate"/>
        <result column="a4_id" jdbcType="INTEGER" property="foodProduce"/>
        <result column="a5_id" jdbcType="INTEGER" property="drugsBusiness"/>
        <result column="a6_id" jdbcType="INTEGER" property="medicalUse"/>
        <result column="a7_id" jdbcType="INTEGER" property="cosmeticsUse"/>
        <result column="business_type" jdbcType="VARCHAR" property="businessType"/>
        <result column="average_score" jdbcType="REAL" property="averageScore"/>
    </resultMap>

    <resultMap id="EnterpriseId" type="com.example.upc.controller.param.enterpriseId">
        <id column="id" jdbcType="INTEGER" property="id"/>
    </resultMap>

    <resultMap id="NearEnterprise" type="com.example.upc.controller.param.NearEnterprise">
        <result column="enterprise_id" jdbcType="INTEGER" property="enterpriseId"/>
        <result column="point" jdbcType="VARCHAR" property="point"/>
        <result column="check_type" jdbcType="VARCHAR" property="checkType"/>
        <result column="enterprise_name" jdbcType="INTEGER" property="enterpriseName"/>
        <result column="shop_name" jdbcType="VARCHAR" property="shopName"/>
        <result column="cantact_way" jdbcType="VARCHAR" property="cantactWay"/>
        <result column="propaganda_enclosure" jdbcType="VARCHAR" property="propagandaEnclosure"/>
        <result column="average_score" jdbcType="FLOAT" property="averageScore"/>
        <result column="dynamic_grade" jdbcType="VARCHAR" property="dynamicGrade"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 13 11:08:39 CST 2019.
        -->
        id, area_id, enterprise_id, point, operate_time, operator, operate_ip
    </sql>
    <!-- 有许可证的企业 -->
    <sql id="Enterprise_Having_Certi">
        SELECT
        id,enterprise_name,cantact_way,area,grid,registered_address,propaganda_enclosure,dynamic_grade,id_number,operation_mode,business_state,legal_person,average_score,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        (select MIN( maxtime ) from(
        <trim prefixOverrides="union">
            <if test="search.industryList.contains('foodBusiness')">
                select a1_time as maxtime
            </if>
            <if test="search.industryList.contains('smallCater')">
                union select a2_time as maxtime
            </if>
            <if test="search.industryList.contains('smallWorkshop')">
                union select a3_time as maxtime
            </if>
            <if test="search.industryList.contains('foodProduce')">
                union select a4_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsBusiness')">
                union select a5_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsProduce')">
                union select a6_time as maxtime
            </if>
            <if test="search.industryList.contains('cosmeticsUse')">
                union select a7_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalProduce')">
                union select a8_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalBusiness')">
                union select a9_time as maxtime
            </if>
            <if test="search.industryList.contains('industrialProducts')">
                union select a10_time as maxtime
            </if>
        </trim>
        ) A) as max_time FROM (
        <if test="search.industryList.contains('industrialProducts')">SELECT a.*,b.id as a10_id,b.end_time as a10_time
            FROM (
        </if>
        <if test="search.industryList.contains('medicalBusiness')">SELECT a.*,b.id as a9_id,b.end_time as a9_time FROM
            (
        </if>
        <if test="search.industryList.contains('medicalProduce')">SELECT a.*,b.id as a8_id,b.end_time as a8_time FROM
            (
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">SELECT a.*,b.id as a7_id,b.end_time as a7_time FROM (
        </if>
        <if test="search.industryList.contains('drugsProduce')">SELECT a.*,b.id as a6_id,b.end_time as a6_time FROM (
        </if>
        <if test="search.industryList.contains('drugsBusiness')">SELECT a.*,b.id as a5_id,b.end_time as a5_time FROM (
        </if>
        <if test="search.industryList.contains('foodProduce')">SELECT a.*,b.id as a4_id,b.end_time as a4_time FROM (
        </if>
        <if test="search.industryList.contains('smallWorkshop')">SELECT a.*,b.id as a3_id,b.end_time as a3_time FROM (
        </if>
        <if test="search.industryList.contains('smallCater')">SELECT a.*,b.id as a2_id,b.end_time as a2_time FROM (</if>
        <if test="search.industryList.contains('foodBusiness')">SELECT a.* ,b.id as a1_id,b.end_time as a1_time FROM (
        </if>
        SELECT
        id,enterprise_name,cantact_way,area,grid,registered_address,propaganda_enclosure,dynamic_grade,id_number,operation_mode,business_state,legal_person,average_score
        FROM view_supervision_enterprise_score WHERE gps_flag =0
        AND area IN
        <foreach close=")" collection="search.areaList" item="area" open="(" separator=",">#{area}</foreach>
        <if test="search.enterpriseName != null and search.enterpriseName != ''">AND enterprise_name LIKE
            CONCAT('%',#{search.enterpriseName},'%')
        </if>
        <if test="search.supervisor != null and search.supervisor != ''">AND
            FIND_IN_SET(#{search.supervisor},supervisor)
        </if>
        <!--基础小表是根据地区权限和supervisor筛查出来的 -->
        <if test="search.industryList.contains('foodBusiness')">) as a LEFT JOIN supervision_en_food_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallCater')">)as a LEFT JOIN supervision_en_small_cater_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallWorkshop')">)as a LEFT JOIN supervision_en_small_workshop_index as
            b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('foodProduce')">)as a LEFT JOIN supervision_en_food_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsBusiness')">)as a LEFT JOIN supervision_en_drugs_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsProduce')">)as a LEFT JOIN supervision_en_drugs_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">)as a LEFT JOIN supervision_en_cosmetics_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalProduce')">)as a LEFT JOIN supervision_en_medical_pro_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalBusiness')">)as a LEFT JOIN supervision_en_medical_bu_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('industrialProducts')">)as a LEFT JOIN
            supervision_en_industrial_products_index as b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        ) as a
        <trim prefix="WHERE" prefixOverrides="OR">
            <if test="search.industryList.contains('foodBusiness')">
                a1_id
            </if>
            <if test="search.industryList.contains('smallCater')">
                OR a2_id
            </if>
            <if test="search.industryList.contains('smallWorkshop')">
                OR a3_id
            </if>
            <if test="search.industryList.contains('foodProduce')">
                OR a4_id
            </if>
            <if test="search.industryList.contains('drugsBusiness')">
                OR a5_id
            </if>
            <if test="search.industryList.contains('drugsProduce')">
                OR a6_id
            </if>
            <if test="search.industryList.contains('cosmeticsUse')">
                OR a7_id
            </if>
            <if test="search.industryList.contains('medicalProduce')">
                OR a8_id
            </if>
            <if test="search.industryList.contains('medicalBusiness')">
                OR a9_id
            </if>
            <if test="search.industryList.contains('industrialProducts')">
                OR a10_id
            </if>
        </trim><!--trim的用法，设置通用格式并删除前/后缀，在判断生效后添加格式，若前无删前缀，后无删后缀 -->
    </sql>
    <!-- 无许可证的企业 -->
    <sql id="Enterprise_Nothaving_Certi">
        SELECT
        id,enterprise_name,cantact_way,area,grid,registered_address,propaganda_enclosure,dynamic_grade,id_number,operation_mode,business_state,legal_person,average_score,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        (select MIN( maxtime ) from(
        <trim prefixOverrides="union">
            <if test="search.industryList.contains('foodBusiness')">
                select a1_time as maxtime
            </if>
            <if test="search.industryList.contains('smallCater')">
                union select a2_time as maxtime
            </if>
            <if test="search.industryList.contains('smallWorkshop')">
                union select a3_time as maxtime
            </if>
            <if test="search.industryList.contains('foodProduce')">
                union select a4_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsBusiness')">
                union select a5_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsProduce')">
                union select a6_time as maxtime
            </if>
            <if test="search.industryList.contains('cosmeticsUse')">
                union select a7_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalProduce')">
                union select a8_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalBusiness')">
                union select a9_time as maxtime
            </if>
            <if test="search.industryList.contains('industrialProducts')">
                union select a10_time as maxtime
            </if>
        </trim>
        ) A) as max_time FROM (
        <if test="search.industryList.contains('industrialProducts')">SELECT a.*,b.id as a10_id,b.end_time as a10_time
            FROM (
        </if>
        <if test="search.industryList.contains('medicalBusiness')">SELECT a.*,b.id as a9_id,b.end_time as a9_time FROM
            (
        </if>
        <if test="search.industryList.contains('medicalProduce')">SELECT a.*,b.id as a8_id,b.end_time as a8_time FROM
            (
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">SELECT a.*,b.id as a7_id,b.end_time as a7_time FROM (
        </if>
        <if test="search.industryList.contains('drugsProduce')">SELECT a.*,b.id as a6_id,b.end_time as a6_time FROM (
        </if>
        <if test="search.industryList.contains('drugsBusiness')">SELECT a.*,b.id as a5_id,b.end_time as a5_time FROM (
        </if>
        <if test="search.industryList.contains('foodProduce')">SELECT a.*,b.id as a4_id,b.end_time as a4_time FROM (
        </if>
        <if test="search.industryList.contains('smallWorkshop')">SELECT a.*,b.id as a3_id,b.end_time as a3_time FROM (
        </if>
        <if test="search.industryList.contains('smallCater')">SELECT a.*,b.id as a2_id,b.end_time as a2_time FROM (</if>
        <if test="search.industryList.contains('foodBusiness')">SELECT a.* ,b.id as a1_id,b.end_time as a1_time FROM (
        </if>
        SELECT
        id,enterprise_name,cantact_way,area,grid,registered_address,propaganda_enclosure,dynamic_grade,id_number,operation_mode,business_state,legal_person,average_score
        FROM
        WHERE gps_flag =0 and permission_type = ''
        AND area IN
        <foreach close=")" collection="search.areaList" item="area" open="(" separator=",">#{area}</foreach>
        <if test="search.enterpriseName != null and search.enterpriseName != ''">AND enterprise_name LIKE
            CONCAT('%',#{search.enterpriseName},'%')
        </if>
        <if test="search.supervisor != null and search.supervisor != ''">AND
            FIND_IN_SET(#{search.supervisor},supervisor)
        </if>
        <!--基础小表是根据地区权限和supervisor筛查出来的 -->
        <if test="search.industryList.contains('foodBusiness')">) as a LEFT JOIN supervision_en_food_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallCater')">)as a LEFT JOIN supervision_en_small_cater_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallWorkshop')">)as a LEFT JOIN supervision_en_small_workshop_index as
            b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('foodProduce')">)as a LEFT JOIN supervision_en_food_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsBusiness')">)as a LEFT JOIN supervision_en_drugs_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsProduce')">)as a LEFT JOIN supervision_en_drugs_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">)as a LEFT JOIN supervision_en_cosmetics_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalProduce')">)as a LEFT JOIN supervision_en_medical_pro_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalBusiness')">)as a LEFT JOIN supervision_en_medical_bu_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('industrialProducts')">)as a LEFT JOIN
            supervision_en_industrial_products_index as b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        ) as a
    </sql>

    <!-- 有许可证的企业手机 -->
    <sql id="Enterprise_Having_Certi_Phone">
        SELECT
        id,enterprise_name,shop_name,propaganda_enclosure,cantact_way,area,grid,registered_address,dynamic_grade,id_number,operation_mode,business_state,average_score,check_type,dynamic_grade_ex,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        (select MIN( maxtime ) from(
        <trim prefixOverrides="union">
            <if test="search.industryList.contains('foodBusiness')">
                select a1_time as maxtime
            </if>
            <if test="search.industryList.contains('smallCater')">
                union select a2_time as maxtime
            </if>
            <if test="search.industryList.contains('smallWorkshop')">
                union select a3_time as maxtime
            </if>
            <if test="search.industryList.contains('foodProduce')">
                union select a4_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsBusiness')">
                union select a5_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsProduce')">
                union select a6_time as maxtime
            </if>
            <if test="search.industryList.contains('cosmeticsUse')">
                union select a7_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalProduce')">
                union select a8_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalBusiness')">
                union select a9_time as maxtime
            </if>
            <if test="search.industryList.contains('industrialProducts')">
                union select a10_time as maxtime
            </if>
        </trim>
        ) A) as max_time FROM (
        <if test="search.industryList.contains('industrialProducts')">SELECT a.*,b.id as a10_id,b.end_time as a10_time
            FROM (
        </if>
        <if test="search.industryList.contains('medicalBusiness')">SELECT a.*,b.id as a9_id,b.end_time as a9_time FROM
            (
        </if>
        <if test="search.industryList.contains('medicalProduce')">SELECT a.*,b.id as a8_id,b.end_time as a8_time FROM
            (
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">SELECT a.*,b.id as a7_id,b.end_time as a7_time FROM (
        </if>
        <if test="search.industryList.contains('drugsProduce')">SELECT a.*,b.id as a6_id,b.end_time as a6_time FROM (
        </if>
        <if test="search.industryList.contains('drugsBusiness')">SELECT a.*,b.id as a5_id,b.end_time as a5_time FROM (
        </if>
        <if test="search.industryList.contains('foodProduce')">SELECT a.*,b.id as a4_id,b.end_time as a4_time FROM (
        </if>
        <if test="search.industryList.contains('smallWorkshop')">SELECT a.*,b.id as a3_id,b.end_time as a3_time FROM (
        </if>
        <if test="search.industryList.contains('smallCater')">SELECT a.*,b.id as a2_id,b.end_time as a2_time FROM (</if>
        <if test="search.industryList.contains('foodBusiness')">SELECT a.* ,b.id as a1_id,b.end_time as a1_time FROM (
        </if>
        SELECT
        id,enterprise_name,shop_name,propaganda_enclosure,cantact_way,area,grid,registered_address,dynamic_grade,id_number,operation_mode,business_state,average_score,check_type,dynamic_grade_ex
        FROM view_supervision_enterprise_score WHERE gps_flag =0
        AND area IN
        <foreach close=")" collection="search.areaList" item="area" open="(" separator=",">#{area}</foreach>
        <if test="search.supervisor != null and search.supervisor != ''">AND
            FIND_IN_SET(#{search.supervisor},supervisor)
        </if>
        <if test="search.enterpriseName != null and search.enterpriseName != ''">AND enterprise_name LIKE
            CONCAT('%',#{search.enterpriseName},'%')
        </if>
        <if test="search.creditCode != null and search.creditCode != ''">AND id_number LIKE
            CONCAT('%',#{search.creditCode},'%')
        </if>
        <if test="search.operationMode != null and search.operationMode != ''">AND operation_mode LIKE
            CONCAT('%',#{search.operationMode},'%')
        </if>
        <if test="search.businessState != null">AND business_state = #{search.businessState}</if>
        <!--基础小表是根据地区权限和supervisor筛查出来的 -->
        <if test="search.industryList.contains('foodBusiness')">) as a LEFT JOIN supervision_en_food_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallCater')">)as a LEFT JOIN supervision_en_small_cater_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallWorkshop')">)as a LEFT JOIN supervision_en_small_workshop_index as
            b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('foodProduce')">)as a LEFT JOIN supervision_en_food_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsBusiness')">)as a LEFT JOIN supervision_en_drugs_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsProduce')">)as a LEFT JOIN supervision_en_drugs_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">)as a LEFT JOIN supervision_en_cosmetics_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalProduce')">)as a LEFT JOIN supervision_en_medical_pro_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalBusiness')">)as a LEFT JOIN supervision_en_medical_bu_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('industrialProducts')">)as a LEFT JOIN
            supervision_en_industrial_products_index as b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        ) as a
        <trim prefix="WHERE" prefixOverrides="OR">
            <if test="search.industryList.contains('foodBusiness')">
                a1_id
            </if>
            <if test="search.industryList.contains('smallCater')">
                OR a2_id
            </if>
            <if test="search.industryList.contains('smallWorkshop')">
                OR a3_id
            </if>
            <if test="search.industryList.contains('foodProduce')">
                OR a4_id
            </if>
            <if test="search.industryList.contains('drugsBusiness')">
                OR a5_id
            </if>
            <if test="search.industryList.contains('drugsProduce')">
                OR a6_id
            </if>
            <if test="search.industryList.contains('cosmeticsUse')">
                OR a7_id
            </if>
            <if test="search.industryList.contains('medicalProduce')">
                OR a8_id
            </if>
            <if test="search.industryList.contains('medicalBusiness')">
                OR a9_id
            </if>
            <if test="search.industryList.contains('industrialProducts')">
                OR a10_id
            </if>
        </trim><!--trim的用法，设置通用格式并删除前/后缀，在判断生效后添加格式，若前无删前缀，后无删后缀 -->
    </sql>
    <!-- 无许可证的企业手机 -->
    <sql id="Enterprise_NotHaving_Certi_Phone">
        SELECT
        id,enterprise_name,shop_name,propaganda_enclosure,cantact_way,area,grid,registered_address,dynamic_grade,id_number,operation_mode,business_state,average_score,check_type,dynamic_grade_ex,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        (select MIN( maxtime ) from(
        <trim prefixOverrides="union">
            <if test="search.industryList.contains('foodBusiness')">
                select a1_time as maxtime
            </if>
            <if test="search.industryList.contains('smallCater')">
                union select a2_time as maxtime
            </if>
            <if test="search.industryList.contains('smallWorkshop')">
                union select a3_time as maxtime
            </if>
            <if test="search.industryList.contains('foodProduce')">
                union select a4_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsBusiness')">
                union select a5_time as maxtime
            </if>
            <if test="search.industryList.contains('drugsProduce')">
                union select a6_time as maxtime
            </if>
            <if test="search.industryList.contains('cosmeticsUse')">
                union select a7_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalProduce')">
                union select a8_time as maxtime
            </if>
            <if test="search.industryList.contains('medicalBusiness')">
                union select a9_time as maxtime
            </if>
            <if test="search.industryList.contains('industrialProducts')">
                union select a10_time as maxtime
            </if>
        </trim>
        ) A) as max_time FROM (
        <if test="search.industryList.contains('industrialProducts')">SELECT a.*,b.id as a10_id,b.end_time as a10_time
            FROM (
        </if>
        <if test="search.industryList.contains('medicalBusiness')">SELECT a.*,b.id as a9_id,b.end_time as a9_time FROM
            (
        </if>
        <if test="search.industryList.contains('medicalProduce')">SELECT a.*,b.id as a8_id,b.end_time as a8_time FROM
            (
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">SELECT a.*,b.id as a7_id,b.end_time as a7_time FROM (
        </if>
        <if test="search.industryList.contains('drugsProduce')">SELECT a.*,b.id as a6_id,b.end_time as a6_time FROM (
        </if>
        <if test="search.industryList.contains('drugsBusiness')">SELECT a.*,b.id as a5_id,b.end_time as a5_time FROM (
        </if>
        <if test="search.industryList.contains('foodProduce')">SELECT a.*,b.id as a4_id,b.end_time as a4_time FROM (
        </if>
        <if test="search.industryList.contains('smallWorkshop')">SELECT a.*,b.id as a3_id,b.end_time as a3_time FROM (
        </if>
        <if test="search.industryList.contains('smallCater')">SELECT a.*,b.id as a2_id,b.end_time as a2_time FROM (</if>
        <if test="search.industryList.contains('foodBusiness')">SELECT a.* ,b.id as a1_id,b.end_time as a1_time FROM (
        </if>
        SELECT
        id,enterprise_name,shop_name,propaganda_enclosure,cantact_way,area,grid,registered_address,dynamic_grade,id_number,operation_mode,business_state,average_score,check_type,dynamic_grade_ex
        FROM view_supervision_enterprise_score WHERE gps_flag =0 and permission_type = ''
        AND area IN
        <foreach close=")" collection="search.areaList" item="area" open="(" separator=",">#{area}</foreach>
        <if test="search.supervisor != null and search.supervisor != ''">AND
            FIND_IN_SET(#{search.supervisor},supervisor)
        </if>
        <if test="search.enterpriseName != null and search.enterpriseName != ''">AND enterprise_name LIKE
            CONCAT('%',#{search.enterpriseName},'%')
        </if>
        <if test="search.creditCode != null and search.creditCode != ''">AND id_number LIKE
            CONCAT('%',#{search.creditCode},'%')
        </if>
        <if test="search.operationMode != null and search.operationMode != ''">AND operation_mode LIKE
            CONCAT('%',#{search.operationMode},'%')
        </if>
        <if test="search.businessState != null">AND business_state = #{search.businessState}</if>
        <!--基础小表是根据地区权限和supervisor筛查出来的 -->
        <if test="search.industryList.contains('foodBusiness')">) as a LEFT JOIN supervision_en_food_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallCater')">)as a LEFT JOIN supervision_en_small_cater_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('smallWorkshop')">)as a LEFT JOIN supervision_en_small_workshop_index as
            b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('foodProduce')">)as a LEFT JOIN supervision_en_food_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsBusiness')">)as a LEFT JOIN supervision_en_drugs_bu_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('drugsProduce')">)as a LEFT JOIN supervision_en_drugs_pro_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('cosmeticsUse')">)as a LEFT JOIN supervision_en_cosmetics_index as b on
            a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalProduce')">)as a LEFT JOIN supervision_en_medical_pro_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('medicalBusiness')">)as a LEFT JOIN supervision_en_medical_bu_index as b
            on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        <if test="search.industryList.contains('industrialProducts')">)as a LEFT JOIN
            supervision_en_industrial_products_index as b on a.id =b.enterprise_id
            <if test="search.startTime != null">AND b.end_time &gt;= #{search.startTime}</if>
            <if test="search.endTime != null">AND b.end_time &lt;= #{search.endTime}</if>
            <if test="search.licenseNumber != null and search.licenseNumber != ''">AND b.number LIKE
                CONCAT('%',#{search.licenseNumber},'%')
            </if>
        </if>
        ) as a
    </sql>


    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 13 11:08:39 CST 2019.
        -->
        select
        <include refid="Base_Column_List"/>
        from grid_points
        where id = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 13 11:08:39 CST 2019.
        -->
        delete from grid_points
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.example.upc.dataobject.GridPoints">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 13 11:08:39 CST 2019.
        -->
        insert into grid_points (id, area_id, enterprise_id,
        point, operate_time, operator,
        operate_ip)
        values (#{id,jdbcType=INTEGER}, #{areaId,jdbcType=INTEGER}, #{enterpriseId,jdbcType=INTEGER},
        #{point,jdbcType=VARCHAR}, #{operateTime,jdbcType=TIMESTAMP}, #{operator,jdbcType=VARCHAR},
        #{operateIp,jdbcType=VARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="com.example.upc.dataobject.GridPoints">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 13 11:08:39 CST 2019.
        -->
        insert into grid_points
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="areaId != null">
                area_id,
            </if>
            <if test="enterpriseId != null">
                enterprise_id,
            </if>
            <if test="point != null">
                point,
            </if>
            <if test="operateTime != null">
                operate_time,
            </if>
            <if test="operator != null">
                operator,
            </if>
            <if test="operateIp != null">
                operate_ip,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="areaId != null">
                #{areaId,jdbcType=INTEGER},
            </if>
            <if test="enterpriseId != null">
                #{enterpriseId,jdbcType=INTEGER},
            </if>
            <if test="point != null">
                #{point,jdbcType=VARCHAR},
            </if>
            <if test="operateTime != null">
                #{operateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operator != null">
                #{operator,jdbcType=VARCHAR},
            </if>
            <if test="operateIp != null">
                #{operateIp,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.example.upc.dataobject.GridPoints">
        update grid_points
        <set>
            <if test="areaId != null">
                area_id = #{areaId,jdbcType=INTEGER},
            </if>
            <if test="enterpriseId != null">
                enterprise_id = #{enterpriseId,jdbcType=INTEGER},
            </if>
            <if test="point != null">
                point = #{point,jdbcType=VARCHAR},
            </if>
            <if test="operateTime != null">
                operate_time = #{operateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operator != null">
                operator = #{operator,jdbcType=VARCHAR},
            </if>
            <if test="operateIp != null">
                operate_ip = #{operateIp,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.example.upc.dataobject.GridPoints">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 13 11:08:39 CST 2019.
        -->
        update grid_points
        set area_id = #{areaId,jdbcType=INTEGER},
        enterprise_id = #{enterpriseId,jdbcType=INTEGER},
        point = #{point,jdbcType=VARCHAR},
        operate_time = #{operateTime,jdbcType=TIMESTAMP},
        operator = #{operator,jdbcType=VARCHAR},
        operate_ip = #{operateIp,jdbcType=VARCHAR}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <select id="getAll" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM grid_points
    </select>

    <select id="getAll1" resultMap="BaseResultMap1">
    select a.id,a.area,a.grid,a.registered_address,a.permission_type
    from supervision_enterprise a
    where id>(
    select IFNULL(MAX(c.enterprise_id),0) as id  from grid_points as c
    left join supervision_enterprise as d on c.enterprise_id=d.id
    )
  </select>

    <select id="getSmileAll" resultMap="SmileMap">
        select a.point,a.enterprise_id,b.area,b.grid,b.dynamic_grade,b.operation_mode,b.business_state,b.average_score,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        b.max_time
        FROM grid_points as a inner JOIN
        (
        <include refid="Enterprise_Having_Certi"/>
        union
        <include refid="Enterprise_Nothaving_Certi"/>
        ) as b<!-- 基础大表，根据权限/业态查企业 -->
        on a.enterprise_id=b.id
        union<!-- 组合两种定位方式 -->
        select a.point,b.id as
        enterprise_id,b.area,b.grid,b.dynamic_grade,b.operation_mode,b.business_state,b.average_score,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        b.max_time
        FROM grid_points_gps as a inner JOIN
        (
        <include refid="Enterprise_Having_Certi"/>
        union
        <include refid="Enterprise_Nothaving_Certi"/>
        ) as b<!-- 基础大表，根据权限/业态查企业 -->
        on a.code_id=b.id_number
    </select>

    <select id="getSmileAllPhone" resultMap="SmileMap">
        select * from (
        select a.id,
        a.point,a.enterprise_id,b.enterprise_name,b.area,b.grid,b.registered_address,b.dynamic_grade,b.operation_mode,b.business_state,b.shop_name,b.propaganda_enclosure,b.cantact_way,b.average_score,b.check_type,b.dynamic_grade_ex,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        b.max_time
        FROM grid_points as a inner JOIN
        (
        <include refid="Enterprise_Having_Certi_Phone"/>
        union
        <include refid="Enterprise_NotHaving_Certi_Phone"/>
        ) as b<!-- 基础大表，根据权限/业态查企业 -->
        on a.enterprise_id=b.id
        union<!-- 组合两种定位方式 -->
        select a.id,
        a.point,b.id as
        enterprise_id,b.enterprise_name,b.area,b.grid,b.registered_address,b.dynamic_grade,b.operation_mode,b.business_state,b.shop_name,b.propaganda_enclosure,b.cantact_way,b.average_score,b.check_type,b.dynamic_grade_ex,
        <if test="search.industryList.contains('foodBusiness')">a1_id,</if>
        <if test="search.industryList.contains('smallCater')">a2_id,</if>
        <if test="search.industryList.contains('smallWorkshop')">a3_id,</if>
        <if test="search.industryList.contains('foodProduce')">a4_id,</if>
        <if test="search.industryList.contains('drugsBusiness')">a5_id,</if>
        <if test="search.industryList.contains('drugsProduce')">a6_id,</if>
        <if test="search.industryList.contains('cosmeticsUse')">a7_id,</if>
        <if test="search.industryList.contains('medicalProduce')">a8_id,</if>
        <if test="search.industryList.contains('medicalBusiness')">a9_id,</if>
        <if test="search.industryList.contains('industrialProducts')">a10_id,</if>
        b.max_time
        FROM grid_points_gps as a inner JOIN
        (
        <include refid="Enterprise_Having_Certi_Phone"/>
        union
        <include refid="Enterprise_NotHaving_Certi_Phone"/>
        ) as b<!-- 基础大表，根据权限/业态查企业 -->
        on a.code_id=b.id_number
        ) as a WHERE
        CONVERT ( substring_index( a.point, ',', 1 ), DECIMAL ( 9, 6 ) ) &gt;= #{gps1}
        AND CONVERT ( substring_index( a.point, ',', 1 ), DECIMAL ( 9, 6 ) ) &lt;= #{gps2}
        AND CONVERT ( substring_index( a.point, ',',- 1 ), DECIMAL ( 9, 6 ) ) &gt;= #{gps3}
        AND CONVERT ( substring_index( a.point, ',',- 1 ), DECIMAL ( 9, 6 ) ) &lt;= #{gps4}
    </select>

    <select id="getByAreaId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM grid_points
        WHERE area_id = #{id}
    </select>

    <select id="checkPoint" resultType="Integer">
    select COUNT(*) from grid_points where enterprise_id=#{id}
  </select>

    <select id="getPointByEnterpriseId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from grid_points
        where enterprise_id=#{id}
    </select>

    <update id="updatePoint" parameterType="com.example.upc.dataobject.GridPoints">
        update grid_points
        <set>
            <if test="point != null">
                point = #{point,jdbcType=VARCHAR},
            </if>
            <if test="operateTime != null">
                operate_time = #{operateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operator != null">
                operator = #{operator,jdbcType=VARCHAR},
            </if>
            <if test="operateIp != null">
                operate_ip = #{operateIp,jdbcType=VARCHAR},
            </if>
        </set>
        where area_id = #{areaId,jdbcType=INTEGER} and enterprise_id=#{enterpriseId}
    </update>

    <select id="getEnterpriseByName" parameterType="java.lang.String" resultMap="EnterpriseId">
    select id from supervision_enterprise where enterprise_name like CONCAT('%',#{name},'%')
    </select>

    <delete id="deleteByEnterpriseId" parameterType="java.lang.Integer">
    delete from grid_points where enterprise_id=#{id}
    </delete>

    <select id="getVideoIdByEnterprise" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select IFNULL(max(id),0) as id  from video_parent where enterprise_id = #{id}
  </select>

    <select id="getNearEnterprise" resultMap="NearEnterprise">
        SELECT
        <if test="(search.enterpriseName != null and search.enterpriseName != '') or (search.isList == 1)">
            b.*,d.dynamic_grade,d.dynamic_grade_number,
            CASE WHEN
            c.average_score IS NULL THEN 0
            ELSE c.average_score
            END
            AS average_score,
        </if>
        a.point,a.enterprise_id,d.check_type
        FROM
        <!-- gps点位表-->
        (select enterprise_id,point from grid_points
        <if test="search.isList == 0">
            WHERE
            CONVERT ( substring_index(point, ',', 1 ), DECIMAL ( 9, 6 ) ) &gt;= #{gps1}
            AND CONVERT ( substring_index(point, ',', 1 ), DECIMAL ( 9, 6 ) ) &lt;= #{gps2}
            AND CONVERT ( substring_index(point, ',',- 1 ), DECIMAL ( 9, 6 ) ) &gt;= #{gps3}
            AND CONVERT ( substring_index(point, ',',- 1 ), DECIMAL ( 9, 6 ) ) &lt;= #{gps4}
        </if>) as a
        INNER JOIN
        <!-- 企业表-->
        (SELECT id,enterprise_name,shop_name,propaganda_enclosure,cantact_way,area,grid from
        supervision_enterprise
        <if test="search.enterpriseName != null and search.enterpriseName != ''">
            where enterprise_name LIKE CONCAT('%',#{search.enterpriseName},'%')
        </if>
        )as b on a.enterprise_id = b.id
        <!-- 食品经营许可证表 -->
        LEFT JOIN
        (select
        case
        when instr(b.check_type,"餐饮服务")>instr(b.check_type,"学校食堂") and instr(b.check_type,"学校食堂")>0 then "学校食堂"
        when instr(b.check_type,"学校食堂")>instr(b.check_type,"餐饮服务") and instr(b.check_type,"餐饮服务")>0 then "餐饮服务"
        when instr(b.check_type,"餐饮服务")>0 then "餐饮服务"
        else "学校食堂" end as check_type,b.dynamic_grade,case b.dynamic_grade WHEN "A" THEN 3 WHEN "B" THEN 2 WHEN "C" THEN
        1 ELSE 0 END as dynamic_grade_number,a.enterprise_id
        from supervision_en_food_bu_index as a INNER JOIN supervision_en_food_bu as b on a.id=b.index_id)
        as d on d.enterprise_id = b.id
        <!-- 食安星投票表 -->
        <if test="(search.enterpriseName != null and search.enterpriseName != '') or (search.isList == 1)">
            LEFT JOIN
            (SELECT enterprise_id, AVG( average ) AS average_score FROM user_enterprise_vote GROUP BY enterprise_id)
            AS c ON c.enterprise_id = b.id
        </if>
        <if test="search.checkType != null and search.checkType != ''">
            where check_type like CONCAT('%',#{search.checkType},'%')
        </if>
        <if test="search.sortList.contains('dynamicGrade')">
            ORDER BY dynamic_grade_number DESC
        </if>
        <if test="search.sortList.contains('averageScore')">
            ORDER BY average_score DESC
        </if>
        <if test="search.isList == 1">
            limit #{page.offset}, #{page.pageSize}
        </if>
    </select>

    <select id="getEnterpriseByParam" resultMap="NearEnterprise">
        SELECT
        b.id enterprise_id,b.enterprise_name,b.shop_name,b.propaganda_enclosure,b.cantact_way,b.area,b.grid,c.average_score,d.check_type,d.dynamic_grade
        from
        (SELECT id,enterprise_name,shop_name,propaganda_enclosure,cantact_way,area,grid FROM supervision_enterprise
        <where>
            id in
            <foreach item="item" collection="search.ids" separator="," open="(" close=")" index="">
                #{item, jdbcType=NUMERIC}
            </foreach>
        </where>
        ) as b
        LEFT JOIN
        (SELECT b.check_type,b.dynamic_grade,a.enterprise_id
        from supervision_en_food_bu_index as a INNER JOIN supervision_en_food_bu as b on a.id=b.index_id
        <where>
            enterprise_id in
            <foreach item="item" collection="search.ids" separator="," open="(" close=")" index="">
                #{item, jdbcType=NUMERIC}
            </foreach>
        </where>
        ) as d on d.enterprise_id = b.id
        LEFT JOIN
        (SELECT enterprise_id, AVG( average ) AS average_score FROM user_enterprise_vote
        <where>
            enterprise_id in
            <foreach item="item" collection="search.ids" separator="," open="(" close=")" index="">
                #{item, jdbcType=NUMERIC}
            </foreach>
        </where>
        GROUP BY enterprise_id)
        AS c ON c.enterprise_id = b.id
    </select>
</mapper>